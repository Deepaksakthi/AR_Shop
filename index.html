<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR.js Location Tags with Mapbox</title>
    <style>
        /* Define a style for the location tags */
        .location-tag {
            background-color:#be0118;
            color: #316ef0;
            padding: 5px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="scene-container"></div>

    <!-- Include AR.js and Mapbox libraries -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.3.1/aframe/build/aframe-ar.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.5.1/mapbox-gl.js"></script>

    <script>
        // Request camera access
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function (stream) {
                // Camera access is granted; you can proceed with your AR scene setup.
            })
            .catch(function (error) {
                console.error('Camera access denied:', error);
            });
        // Your Mapbox Access Token
        mapboxgl.accessToken = 'pk.eyJ1Ijoia2F2aS0wMyIsImEiOiJjbG84bXJ1YzEwMm5hMmttdWVxZGV0MXJ0In0.Wc5-t7YS01yVUgQE1hMCmQ';

        AFRAME.registerComponent('location-tag', {
            schema: {
                latitude: { type: 'number' },
                longitude: { type: 'number' },
                text: { type: 'string' },
            },
            init: function () {
                const { latitude, longitude, text } = this.data;
                const el = this.el;

                // Create a mapbox marker
                const marker = document.createElement('a-entity');
                marker.setAttribute('gps-entity-place', `latitude: ${latitude}; longitude: ${longitude}`);
                marker.setAttribute('scale', '10 10 10');
                el.appendChild(marker);

                // Create the location tag
                const tag = document.createElement('a-plane');
                tag.setAttribute('class', 'location-tag');
                tag.setAttribute('position', '0 1 0');
                tag.setAttribute('scale', '0.2 0.1 1');
                tag.setAttribute('text', `value: ${text}`);
                marker.appendChild(tag);
            },
        });

        AFRAME.registerComponent('arjs-map', {
            init: function () {
                const sceneEl = document.querySelector('a-scene');

                // Create location tags using location-tag component
                const locations = [
                    { latitude: 40.712776, longitude: -74.005974, text: 'New York City' },
                    // Add more locations here
                ];

                locations.forEach((location) => {
                    const tagEl = document.createElement('a-entity');
                    tagEl.setAttribute('location-tag', location);
                    sceneEl.appendChild(tagEl);
                });
            },
        });
    </script>

    <!-- Define the AR scene -->
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-camera-static></a-camera-static>
        <a-entity arjs-map></a-entity>
    </a-scene>
</body>
</html>
